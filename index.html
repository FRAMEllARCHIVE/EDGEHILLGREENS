<!DOCTYPE html>
<!-- Legal Footnote: This content is subject to copyright and should not be reproduced without permission. -->
<!-- Written and created by Thomas John-Michael de Beer, feel free to contact me via tjdebeer@gmail.com  -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="manifest" href="manifest.json">
  <title>Edgehill Greens Livestock Auctions</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <meta name="author" content="Edgehill Greens">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="description" content="Join the Edgehill Greens Livestock Auction to bid on premium livestock.">
  <meta name="keywords" content="livestock, auction, bidding, cattle, sheep, Edgehill Greens">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    :root {
      --primary-color: #3498db;
      --secondary-color: #2c3e50;
      --accent-color: #27ae60;
      --text-color: #333;
      --bg-color: #f4f4f4;
    }

    * {
      -webkit-tap-highlight-color: transparent;
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
    }

.container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
    }

.banner {
            width: 100%;
            object-fit: cover;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }

.profile-image {
        width: 66px;
        height: 66px;
        border-radius: 50%;
        position: fixed;
        top: 77px;
        right: 22px;
        z-index: 1003;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: 0.9s ease;
}

.profile-image:hover {
      transform: scale(1.1);
    }

.fixed-profile-image {
        top: auto;
        bottom: 22px;
        transition: 0.9s ease;
}

.favorite-count {
        position: fixed;
        top: 71px;
        right: 18px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.9rem;
        font-weight: bold;
        z-index: 1004;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.favorite-count.red {
        background-color: #e74c3c;
        color: white;
        font-size: 1.1rem;
}

.favorite-count.green {
        background-color: #2ecc71;
        color: white;
        font-size: 0.6rem;
}

.fixed-favorite-count {
      top: auto;
      bottom: 19px;
}

.product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      scroll-snap-type: y mandatory;
    }

    .product-card {
      position: relative;
      background-color: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

.product-card .favorite {
      position: absolute;
      top: 206px;
      right: 3px;
      color: #f39c12;
      cursor: pointer;
      z-index: 1003;
      opacity: 0.9;
      transition: 0.3s ease;
      padding: 10px;
}

.product-card .favorite:hover {
      color: #e67e22;
      transform: scale(1.2);
      opacity: 0.9;
}

.product-card .favorite.clicked {
    color: #e67e22;
    transform: scale(1.1);
    opacity: 1;
}

.product-card .refresh-icon {
        position: absolute;
      top: 233px;
      right: 0px;
        color: #2980b9;
        cursor: pointer;
        z-index: 1003;
        opacity: 0.8;
        transition: 0.3s ease;
        padding: 15px;
}

.product-card .refresh-icon:hover {
        opacity: 0.9;
        transform: scale(1.1);
}

.rotate {
        animation: rotateIcon 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
}

@keyframes rotateIcon {
  0%, 100% {
    transform: rotate(0deg) scale(1);
    opacity: 0.8;
  }
  50% {
    transform: rotate(180deg) scale(1.2);
    opacity: 1;
  }
  100% {
    transform: rotate(360deg) scale(1);
    opacity: 0.8;
  }
}

.product-video-container {
    position: relative;
    height: 200px;
    width: 100%;
    overflow: hidden;
    background-color: black;
}

.product-video {
    position: absolute;
    top: 50%;
    left: 50%;
    height: 105.5%;
    width: 105.5%;
    transform: translate(-50%, -50%);
    object-fit: cover;
}


    .product-info {
      padding: 15px;
    }

    .product-title {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }

    .product-description {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 10px;
      margin-right: 33px;
    }

    .product-price {
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--accent-color);
      margin-bottom: 10px;
    }

.bid-form {
      display: flex;
      margin-bottom: 10px;
    }

.bid-input {
      flex-grow: 1;
      padding: 5px;
      font-size: 1rem;
      border: 1px solid #ddd;
      border-radius: 5px 0 0 5px;
    }

.bid-button {
      background-color: var(--accent-color);
      color: white;
      border: none;
      padding: 5px 20px;
      cursor: pointer;
      border-radius: 0 5px 5px 0;
      transition: background-color 0.3s ease;
    }

.bid-button:hover {
      background-color: #2ecc71;
    }

.countdown {
      font-size: 0.9rem;
      color: #e74c3c;
      font-weight: bold;
    }

footer {
        padding: 0.95rem;
        text-align: center;
        background-color: #333;
        color: white; 
        width: 100%;
}

#overlay2 {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      display: none;
      z-index: 2000;
    }

#profileUpdateForm {
    letter-spacing: 0.5px;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: none;
    width: 80dvw;
    max-width: 300px;
    padding: 20px;
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    border-top-left-radius: 77px;
    border-top-right-radius: 77px;
    border-bottom-left-radius: 33px;
    border-bottom-right-radius: 77px;
    margin-top: 20px;
    z-index: 2222;
  }
  
#profileUpdateForm label {
    display: block;
    margin-bottom: 8px;
  }
  
#profileUpdateForm input[type="text"] {
    letter-spacing: 0.6px;
    width: calc(100% - 20px);
    padding: 8px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 12px;
    margin-bottom: 12px;
  }
  
#profileUpdateForm button {
    letter-spacing: 1.1px;
    padding: 10px 20px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    margin-right: 10px;
    font-size: 14px;
  }
  
#profileUpdateForm button:hover {
    background-color: #0056b3;
  }

.profileUpdateprofile-image {
      width: 111px;
      height: 111px;
      border-radius: 50%;
      margin-bottom: 12px;
    }

.phone-number-container {
    display: flex;
    align-items: center;
    margin-bottom: 0px;
}

.phone-number-container select,
.phone-number-container input[type="text"] {
    border-radius: 12px;
    border: 1px solid #ccc;
    padding: 8px;
    font-size: 14px;
    margin-bottom: 12px;
}

.phone-number-container select {
    width: 38%;
    margin-right: 10px;
}

.phone-number-container input[type="text"] {
    margin-right: 20px;
}

#overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      display: none;
      z-index: 2000;
    }

#AddProduct {
      width: 66px;
      height: 66px;
      background-color: #2ecc71;
      border-radius: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0 auto;
      margin-top: 16px;
      box-shadow: 0 3px 4px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      font-size: 48px;
      color: white;
      font-weight: bold;
      transition: 0.3s;
      opacity: 1;
    }

#AddProduct:hover {
      transform: scale(1.1);
      opacity: 1;
    }

#AddProduct i {
      transition: transform 0.3s;
    }

#AddProduct:hover i {
      transform: scale(1.1);
    }

#productForm {
  letter-spacing: 0.5px;
  position: fixed;
  top: 47%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: none;
  width: 90vw;
  max-width: 333px;
  padding: 12px;
  background-color: #f0f0f0;
  border: 1px solid #ccc;
  border-radius: 42px;
  margin-top: 20px;
  z-index: 2222;
  text-align: center;
}

#productForm label {
  display: block;
  margin-bottom: 8px;
  text-align: center;
}

#productForm input[type="text"],
#productForm textarea,
#productForm input[type="file"],
#productForm input[type="url"],
#productForm button {
      width: calc(100% - 20px);
      padding: 8px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 18px;
      margin-bottom: 12px;
      box-sizing: border-box;
      text-align: center;
}

#productForm button {
  letter-spacing: 1.1px;
  padding: 10px 20px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 18px;
  cursor: pointer;
  font-size: 14px;
}

#productForm button:hover {
  background-color: #0056b3;
}

#RefreshList {
      width: 88px;
      height: 88px;
      background-color: transparent;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0 auto;
      cursor: pointer;
      font-size: 48px;
      color: #2ecc71;
      font-weight: bold;
      transition: 0.3s;
      opacity: 1;
    }

#RefreshList:hover {
      transform: scale(1.1);
      opacity: 1;
    }

#RefreshList i {
      transition: transform 0.3s;
    }

#RefreshList:hover i {
      animation: rotateIcon 2s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
      transform: scale(1.2);
    }

.product-card2 {
      position: relative;
      background-color: #2ecc71;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

.product-card2 .favorite {
      position: absolute;
      top: 206px;
      right: 3px;
      color: #FFFF00;
      cursor: pointer;
      z-index: 1003;
      opacity: 0.7;
      transition: 0.3s ease;
      padding: 10px;
}

.product-card2 .favorite:hover {
      color: #FFFF00;
      transform: scale(1.1);
      opacity: 1;
}

.product-card2 .refresh-icon {
      position: absolute;
      top: 233px;
      right: 0px;
      color: #2980b9;
      cursor: pointer;
      z-index: 1003;
      opacity: 0.9;
      transition: 0.3s ease;
      padding: 15px;
}

.product-card2 .refresh-icon:hover {
      opacity: 1;
      transform: scale(1.1);
}

.product-price2 {
      font-size: 1.5rem;
      font-weight: bold;
      color: white;
      margin-bottom: 10px;
    }

.product-description2 {
      margin-right: 33px;
      margin-bottom: 22px;
      opacity: 0.9;
    }

.highest-bidder {
      font-size: 1.1rem;
      color: white;
      opacity: 0.8;
    }

.bidder-contact {
      font-size: 1.1rem;
      color: white;
      opacity: 0.8;
      letter-spacing: 0.04em;
    }
                
.bid-time {
      font-size: 1.1rem;
      color: white;
      opacity: 0.8;
      letter-spacing: 0.05em;
    }

.countdown2 {
      font-size: 1.1rem;
      color: white;
      opacity: 0.5;
    }

  #search-input {
    width: 100%;
    padding: 10px 15px;
    border: 1px solid #ddd;
    border-radius: 22px;
    font-size: 16px;
    outline: none;
  }
  .tag {
    display: inline-block;
    background-color: #e0e0e0;
    border-radius: 16px;
    padding: 2px 11px;
    margin: 0px 5px 5px 0;
    font-size: 14px;
  }
  .tag-close {
    margin-left: 5px;
    cursor: pointer;
    font-weight: bold;
  }
  #tag-container {
    margin-top: 10px;
    margin-bottom: 10px;
  }

#productTagContainer {
  margin-top: 0px;
  margin-bottom: 0px;
}

#productTags {
  width: 100%;
  padding: 10px 15px;
  border: 1px solid #ddd;
  border-radius: 22px;
  font-size: 16px;
  outline: none;
}

  </style>
</head>
<body>
  <img src="edgehill2.png" alt="Edgehill Greens Livestock Auction" class="banner">

<span class="favorite-count" style="cursor: pointer;" onclick="EditProfile()">
  <i id="profileIcon" class="fas fa-check"></i>
</span>

  <main class="container" style="margin-top: 20px;">
<div class="search-container">
  <input type="text" id="search-input" placeholder="Search tags...">
  <div id="tag-container"></div>
  <div id="AddProduct" onclick="AddProduct()">
    <i class="fas fa-plus"></i>
  </div>
<br>
</div>
    </div>

    <div class="product-grid" id="productGrid">

    </div>
  </div>

<br>
    </div>
  </main>
<br>
  <div id="RefreshList" onclick="RefreshList()">
                <i class="fas fa-sync-alt refresh-icon"></i>
  </div>
<br><br>
<footer>
   EDGEHILL GREENS © 2024. <br>
   All Rights Reserved.
</footer>

  <form id="profileForm">
    <input type="file" id="profileImageInput" accept="image/*" style="display: none;">
    <label for="profileImageInput" id="profileImageLabel" style="cursor: pointer;">
       <img src="profile.jpg" alt="Current Profile Image" id="profileImage" class="profile-image">
    </label>
  </form>
  <div id="uploadStatus"></div>


  <div id="overlay2" onclick="CloseProfileForm()"></div>

    <form id="profileUpdateForm">
        <img src="profile.jpg" alt="Current Profile Image" id="currentProfileImage" class="profileUpdateprofile-image">

        <label for="nameInput">Name:</label>
        <input type="text" id="nameInput" name="name" required><br><br>

        <label for="phoneInput">Phone Number:</label>
        <div class="phone-number-container">
<select id="countryCodeInput" name="countryCode" required>
    <option value="+93" data-country="Afghanistan" data-code="+93">Afghanistan</option>
    <option value="+355" data-country="Albania" data-code="+355">Albania</option>
    <option value="+213" data-country="Algeria" data-code="+213">Algeria</option>
    <option value="+1684" data-country="American Samoa" data-code="+1684">American Samoa</option>
    <option value="+376" data-country="Andorra" data-code="+376">Andorra</option>
    <option value="+244" data-country="Angola" data-code="+244">Angola</option>
    <option value="+1" data-country="Antigua and Barbuda" data-code="+1">Antigua and Barbuda</option>
    <option value="+54" data-country="Argentina" data-code="+54">Argentina</option>
    <option value="+374" data-country="Armenia" data-code="+374">Armenia</option>
    <option value="+297" data-country="Aruba" data-code="+297">Aruba</option>
    <option value="+61" data-country="Australia" data-code="+61">Australia</option>
    <option value="+43" data-country="Austria" data-code="+43">Austria</option>
    <option value="+994" data-country="Azerbaijan" data-code="+994">Azerbaijan</option>
    <option value="+242" data-country="Republic of the Congo" data-code="+242">Republic of the Congo</option>
    <option value="+243" data-country="Democratic Republic of the Congo" data-code="+243">Democratic Republic of the Congo</option>
    <option value="+1" data-country="Bahamas" data-code="+1">Bahamas</option>
    <option value="+973" data-country="Bahrain" data-code="+973">Bahrain</option>
    <option value="+880" data-country="Bangladesh" data-code="+880">Bangladesh</option>
    <option value="+1" data-country="Barbados" data-code="+1">Barbados</option>
    <option value="+375" data-country="Belarus" data-code="+375">Belarus</option>
    <option value="+32" data-country="Belgium" data-code="+32">Belgium</option>
    <option value="+501" data-country="Belize" data-code="+501">Belize</option>
    <option value="+229" data-country="Benin" data-code="+229">Benin</option>
    <option value="+1" data-country="Bermuda" data-code="+1">Bermuda</option>
    <option value="+975" data-country="Bhutan" data-code="+975">Bhutan</option>
    <option value="+591" data-country="Bolivia" data-code="+591">Bolivia</option>
    <option value="+387" data-country="Bosnia and Herzegovina" data-code="+387">Bosnia and Herzegovina</option>
    <option value="+267" data-country="Botswana" data-code="+267">Botswana</option>
    <option value="+55" data-country="Brazil" data-code="+55">Brazil</option>
    <option value="+246" data-country="British Indian Ocean Territory" data-code="+246">British Indian Ocean Territory</option>
    <option value="+1" data-country="British Virgin Islands" data-code="+1">British Virgin Islands</option>
    <option value="+673" data-country="Brunei" data-code="+673">Brunei</option>
    <option value="+359" data-country="Bulgaria" data-code="+359">Bulgaria</option>
    <option value="+226" data-country="Burkina Faso" data-code="+226">Burkina Faso</option>
    <option value="+257" data-country="Burundi" data-code="+257">Burundi</option>
    <option value="+855" data-country="Cambodia" data-code="+855">Cambodia</option>
    <option value="+237" data-country="Cameroon" data-code="+237">Cameroon</option>
    <option value="+1" data-country="Canada" data-code="+1">Canada</option>
    <option value="+238" data-country="Cape Verde" data-code="+238">Cape Verde</option>
    <option value="+1" data-country="Cayman Islands" data-code="+1">Cayman Islands</option>
    <option value="+236" data-country="Central African Republic" data-code="+236">Central African Republic</option>
    <option value="+235" data-country="Chad" data-code="+235">Chad</option>
    <option value="+56" data-country="Chile" data-code="+56">Chile</option>
    <option value="+86" data-country="China" data-code="+86">China</option>
    <option value="+61" data-country="Christmas Island" data-code="+61">Christmas Island</option>
    <option value="+61" data-country="Cocos (Keeling) Islands" data-code="+61">Cocos (Keeling) Islands</option>
    <option value="+57" data-country="Colombia" data-code="+57">Colombia</option>
    <option value="+269" data-country="Comoros" data-code="+269">Comoros</option>
    <option value="+242" data-country="Congo" data-code="+242">Congo</option>
    <option value="+682" data-country="Cook Islands" data-code="+682">Cook Islands</option>
    <option value="+506" data-country="Costa Rica" data-code="+506">Costa Rica</option>
    <option value="+225" data-country="Côte d'Ivoire" data-code="+225">Côte d'Ivoire</option>
    <option value="+385" data-country="Croatia" data-code="+385">Croatia</option>
    <option value="+53" data-country="Cuba" data-code="+53">Cuba</option>
    <option value="+599" data-country="Curaçao" data-code="+599">Curaçao</option>
    <option value="+357" data-country="Cyprus" data-code="+357">Cyprus</option>
    <option value="+420" data-country="Czech Republic" data-code="+420">Czech Republic</option>
    <option value="+45" data-country="Denmark" data-code="+45">Denmark</option>
    <option value="+253" data-country="Djibouti" data-code="+253">Djibouti</option>
    <option value="+1" data-country="Dominica" data-code="+1">Dominica</option>
    <option value="+682" data-country="Dominican Republic" data-code="+682">Dominican Republic</option>
    <option value="+593" data-country="Ecuador" data-code="+593">Ecuador</option>
    <option value="+20" data-country="Egypt" data-code="+20">Egypt</option>
    <option value="+503" data-country="El Salvador" data-code="+503">El Salvador</option>
    <option value="+244" data-country="Equatorial Guinea" data-code="+244">Equatorial Guinea</option>
    <option value="+291" data-country="Eritrea" data-code="+291">Eritrea</option>
    <option value="+372" data-country="Estonia" data-code="+372">Estonia</option>
    <option value="+268" data-country="Eswatini" data-code="+268">Eswatini</option>
    <option value="+25" data-country="Ethiopia" data-code="+25">Ethiopia</option>
    <option value="+500" data-country="Falkland Islands" data-code="+500">Falkland Islands</option>
    <option value="+298" data-country="Faroe Islands" data-code="+298">Faroe Islands</option>
    <option value="+679" data-country="Fiji" data-code="+679">Fiji</option>
    <option value="+358" data-country="Finland" data-code="+358">Finland</option>
    <option value="+33" data-country="France" data-code="+33">France</option>
    <option value="+689" data-country="French Polynesia" data-code="+689">French Polynesia</option>
    <option value="+241" data-country="Gabon" data-code="+241">Gabon</option>
    <option value="+220" data-country="Gambia" data-code="+220">Gambia</option>
    <option value="+995" data-country="Georgia" data-code="+995">Georgia</option>
    <option value="+49" data-country="Germany" data-code="+49">Germany</option>
    <option value="+233" data-country="Ghana" data-code="+233">Ghana</option>
    <option value="+350" data-country="Gibraltar" data-code="+350">Gibraltar</option>
    <option value="+30" data-country="Greece" data-code="+30">Greece</option>
    <option value="+299" data-country="Greenland" data-code="+299">Greenland</option>
    <option value="+1" data-country="Grenada" data-code="+1">Grenada</option>
    <option value="+590" data-country="Guadeloupe" data-code="+590">Guadeloupe</option>
    <option value="+Guam" data-country="Guam" data-code="+1">Guam</option>
    <option value="+502" data-country="Guatemala" data-code="+502">Guatemala</option>
    <option value="+44" data-country="Guernsey" data-code="+44">Guernsey</option>
    <option value="+224" data-country="Guinea" data-code="+224">Guinea</option>
    <option value="+245" data-country="Guinea-Bissau" data-code="+245">Guinea-Bissau</option>
    <option value="+595" data-country="Paraguay" data-code="+595">Paraguay</option>
    <option value="+504" data-country="Honduras" data-code="+504">Honduras</option>
    <option value="+36" data-country="Hungary" data-code="+36">Hungary</option>
    <option value="+354" data-country="Iceland" data-code="+354">Iceland</option>
    <option value="+91" data-country="India" data-code="+91">India</option>
    <option value="+62" data-country="Indonesia" data-code="+62">Indonesia</option>
    <option value="+98" data-country="Iran" data-code="+98">Iran</option>
    <option value="+964" data-country="Iraq" data-code="+964">Iraq</option>
    <option value="+353" data-country="Ireland" data-code="+353">Ireland</option>
    <option value="+44" data-country="Isle of Man" data-code="+44">Isle of Man</option>
    <option value="+972" data-country="Israel" data-code="+972">Israel</option>
    <option value="+39" data-country="Italy" data-code="+39">Italy</option>
    <option value="+1" data-country="Jamaica" data-code="+1">Jamaica</option>
    <option value="+81" data-country="Japan" data-code="+81">Japan</option>
    <option value="+44" data-country="Jersey" data-code="+44">Jersey</option>
    <option value="+962" data-country="Jordan" data-code="+962">Jordan</option>
    <option value="+7" data-country="Kazakhstan" data-code="+7">Kazakhstan</option>
    <option value="+254" data-country="Kenya" data-code="+254">Kenya</option>
    <option value="+686" data-country="Kiribati" data-code="+686">Kiribati</option>
    <option value="+850" data-country="North Korea" data-code="+850">North Korea</option>
    <option value="+82" data-country="South Korea" data-code="+82">South Korea</option>
    <option value="+965" data-country="Kuwait" data-code="+965">Kuwait</option>
    <option value="+996" data-country="Kyrgyzstan" data-code="+996">Kyrgyzstan</option>
    <option value="+856" data-country="Laos" data-code="+856">Laos</option>
    <option value="+371" data-country="Latvia" data-code="+371">Latvia</option>
    <option value="+961" data-country="Lebanon" data-code="+961">Lebanon</option>
    <option value="+266" data-country="Lesotho" data-code="+266">Lesotho</option>
    <option value="+231" data-country="Liberia" data-code="+231">Liberia</option>
    <option value="+218" data-country="Libya" data-code="+218">Libya</option>
    <option value="+423" data-country="Liechtenstein" data-code="+423">Liechtenstein</option>
    <option value="+370" data-country="Lithuania" data-code="+370">Lithuania</option>
    <option value="+352" data-country="Luxembourg" data-code="+352">Luxembourg</option>
    <option value="+853" data-country="Macau" data-code="+853">Macau</option>
    <option value="+389" data-country="North Macedonia" data-code="+389">North Macedonia</option>
    <option value="+261" data-country="Madagascar" data-code="+261">Madagascar</option>
    <option value="+265" data-country="Malawi" data-code="+265">Malawi</option>
    <option value="+60" data-country="Malaysia" data-code="+60">Malaysia</option>
    <option value="+960" data-country="Maldives" data-code="+960">Maldives</option>
    <option value="+223" data-country="Mali" data-code="+223">Mali</option>
    <option value="+356" data-country="Malta" data-code="+356">Malta</option>
    <option value="+692" data-country="Marshall Islands" data-code="+692">Marshall Islands</option>
    <option value="+596" data-country="Martinique" data-code="+596">Martinique</option>
    <option value="+222" data-country="Mauritania" data-code="+222">Mauritania</option>
    <option value="+230" data-country="Mauritius" data-code="+230">Mauritius</option>
    <option value="+262" data-country="Mayotte" data-code="+262">Mayotte</option>
    <option value="+52" data-country="Mexico" data-code="+52">Mexico</option>
    <option value="+691" data-country="Micronesia" data-code="+691">Micronesia</option>
    <option value="+373" data-country="Moldova" data-code="+373">Moldova</option>
    <option value="+377" data-country="Monaco" data-code="+377">Monaco</option>
    <option value="+976" data-country="Mongolia" data-code="+976">Mongolia</option>
    <option value="+382" data-country="Montenegro" data-code="+382">Montenegro</option>
    <option value="+1664" data-country="Montserrat" data-code="+1664">Montserrat</option>
    <option value="+212" data-country="Morocco" data-code="+212">Morocco</option>
    <option value="+258" data-country="Mozambique" data-code="+258">Mozambique</option>
    <option value="+95" data-country="Myanmar" data-code="+95">Myanmar</option>
    <option value="+264" data-country="Namibia" data-code="+264">Namibia</option>
    <option value="+674" data-country="Nauru" data-code="+674">Nauru</option>
    <option value="+977" data-country="Nepal" data-code="+977">Nepal</option>
    <option value="+31" data-country="Netherlands" data-code="+31">Netherlands</option>
    <option value="+687" data-country="New Caledonia" data-code="+687">New Caledonia</option>
    <option value="+64" data-country="New Zealand" data-code="+64">New Zealand</option>
    <option value="+505" data-country="Nicaragua" data-code="+505">Nicaragua</option>
    <option value="+227" data-country="Niger" data-code="+227">Niger</option>
    <option value="+234" data-country="Nigeria" data-code="+234">Nigeria</option>
    <option value="+683" data-country="Niue" data-code="+683">Niue</option>
    <option value="+850" data-country="North Korea" data-code="+850">North Korea</option>
    <option value="+47" data-country="Norway" data-code="+47">Norway</option>
    <option value="+968" data-country="Oman" data-code="+968">Oman</option>
    <option value="+92" data-country="Pakistan" data-code="+92">Pakistan</option>
    <option value="+680" data-country="Palau" data-code="+680">Palau</option>
    <option value="+970" data-country="Palestine" data-code="+970">Palestine</option>
    <option value="+507" data-country="Panama" data-code="+507">Panama</option>
    <option value="+675" data-country="Papua New Guinea" data-code="+675">Papua New Guinea</option>
    <option value="+595" data-country="Paraguay" data-code="+595">Paraguay</option>
    <option value="+51" data-country="Peru" data-code="+51">Peru</option>
    <option value="+63" data-country="Philippines" data-code="+63">Philippines</option>
    <option value="+48" data-country="Poland" data-code="+48">Poland</option>
    <option value="+351" data-country="Portugal" data-code="+351">Portugal</option>
    <option value="+1" data-country="Puerto Rico" data-code="+1">Puerto Rico</option>
    <option value="+974" data-country="Qatar" data-code="+974">Qatar</option>
    <option value="+40" data-country="Romania" data-code="+40">Romania</option>
    <option value="+7" data-country="Russia" data-code="+7">Russia</option>
    <option value="+250" data-country="Rwanda" data-code="+250">Rwanda</option>
    <option value="+590" data-country="Saint Barthélemy" data-code="+590">Saint Barthélemy</option>
    <option value="+290" data-country="Saint Helena" data-code="+290">Saint Helena</option>
    <option value="+1" data-country="Saint Kitts and Nevis" data-code="+1">Saint Kitts and Nevis</option>
    <option value="+1" data-country="Saint Lucia" data-code="+1">Saint Lucia</option>
    <option value="+1" data-country="Saint Martin" data-code="+1">Saint Martin</option>
    <option value="+508" data-country="Saint Pierre and Miquelon" data-code="+508">Saint Pierre and Miquelon</option>
    <option value="+1" data-country="Saint Vincent and the Grenadines" data-code="+1">Saint Vincent and the Grenadines</option>
    <option value="+685" data-country="Samoa" data-code="+685">Samoa</option>
    <option value="+378" data-country="San Marino" data-code="+378">San Marino</option>
    <option value="+239" data-country="Sao Tome and Principe" data-code="+239">Sao Tome and Principe</option>
    <option value="+966" data-country="Saudi Arabia" data-code="+966">Saudi Arabia</option>
    <option value="+221" data-country="Senegal" data-code="+221">Senegal</option>
    <option value="+381" data-country="Serbia" data-code="+381">Serbia</option>
    <option value="+248" data-country="Seychelles" data-code="+248">Seychelles</option>
    <option value="+232" data-country="Sierra Leone" data-code="+232">Sierra Leone</option>
    <option value="+65" data-country="Singapore" data-code="+65">Singapore</option>
    <option value="+721" data-country="Sint Maarten" data-code="+721">Sint Maarten</option>
    <option value="+1" data-country="Solomon Islands" data-code="+1">Solomon Islands</option>
    <option value="+677" data-country="Solomon Islands" data-code="+677">Solomon Islands</option>
    <option value="+27" data-country="South Africa" data-code="+27">South Africa</option>
    <option value="+34" data-country="Spain" data-code="+34">Spain</option>
    <option value="+94" data-country="Sri Lanka" data-code="+94">Sri Lanka</option>
    <option value="+249" data-country="Sudan" data-code="+249">Sudan</option>
    <option value="+597" data-country="Suriname" data-code="+597">Suriname</option>
    <option value="+268" data-country="Swaziland" data-code="+268">Swaziland</option>
    <option value="+46" data-country="Sweden" data-code="+46">Sweden</option>
    <option value="+41" data-country="Switzerland" data-code="+41">Switzerland</option>
    <option value="+963" data-country="Syria" data-code="+963">Syria</option>
    <option value="+886" data-country="Taiwan" data-code="+886">Taiwan</option>
    <option value="+255" data-country="Tanzania" data-code="+255">Tanzania</option>
    <option value="+1" data-country="Trinidad and Tobago" data-code="+1">Trinidad and Tobago</option>
    <option value="+216" data-country="Tunisia" data-code="+216">Tunisia</option>
    <option value="+90" data-country="Turkey" data-code="+90">Turkey</option>
    <option value="+993" data-country="Turkmenistan" data-code="+993">Turkmenistan</option>
    <option value="+1" data-country="Turks and Caicos Islands" data-code="+1">Turks and Caicos Islands</option>
    <option value="+688" data-country="Tuvalu" data-code="+688">Tuvalu</option>
    <option value="+256" data-country="Uganda" data-code="+256">Uganda</option>
    <option value="+380" data-country="Ukraine" data-code="+380">Ukraine</option>
    <option value="+971" data-country="United Arab Emirates" data-code="+971">United Arab Emirates</option>
    <option value="+44" data-country="United Kingdom" data-code="+44">United Kingdom</option>
    <option value="+1" data-country="United States" data-code="+1">United States</option>
    <option value="+598" data-country="Uruguay" data-code="+598">Uruguay</option>
    <option value="+998" data-country="Uzbekistan" data-code="+998">Uzbekistan</option>
    <option value="+678" data-country="Vanuatu" data-code="+678">Vanuatu</option>
    <option value="+58" data-country="Venezuela" data-code="+58">Venezuela</option>
    <option value="+84" data-country="Vietnam" data-code="+84">Vietnam</option>
    <option value="+681" data-country="Wallis and Futuna" data-code="+681">Wallis and Futuna</option>
    <option value="+967" data-country="Yemen" data-code="+967">Yemen</option>
    <option value="+260" data-country="Zambia" data-code="+260">Zambia</option>
    <option value="+263" data-country="Zimbabwe" data-code="+263">Zimbabwe</option>
</select>
            <input type="text" id="phoneInput" name="phone" placeholder="Enter phone number" required>
        </div><br><br>

        <button type="button" id="saveProfile">SAVE</button>
        <button type="button" id="deleteProfile">DELETE</button>
    </form>

<div id="overlay" onclick="hideProductForm()"></div>

<div id="productForm" style="display: none;">
  <label for="productTitle">Product Title:</label>
  <input type="text" id="productTitle" name="productTitle" required><br>

  <label for="productDescription">Product Description:</label>
  <input type="text" id="productDescription" name="productDescription" required><br>

  <label for="startingPrice">Starting Price:</label>
  <input type="text" id="startingPrice" name="startingPrice" required><br>

  <label for="productTags">Product Tags:</label>
  <input type="text" id="productTags" name="productTags" placeholder="Add a tag and press Enter" required>
  <div id="productTagContainer"></div>

  <label for="productVideo">Product Video URL:</label>
  <input type="url" id="productVideo" name="productVideo" placeholder="Create a video link using Steamable" required>
  <br>
  <a href="https://streamable.com/" target="_blank" style="display: inline-block; padding: 0px; border-radius: 22px; overflow: hidden; width: 60%; height: 44px;">
    <img src="streamable.png" alt="Streamable" style="display: block; width: 100%; height: 100%; object-fit: cover;">
  </a>
  <br><br>
  <button id="submitButton" type="submit">SUBMIT</button>
</div>

  <script>

const repo2 = 'EDGEHILLGREENS/lllll';
const repo = 'EDGEHILLGREENS/l';
const merpmerp = 'Z2hwX2Q0Q';
const gloopdoop = 'zdSSVFhSzNZ';
const dloogdloog = 'MXNhUnlxSzIz';
const herpherp = gloopdoop + dloogdloog;
const derpderp = 'UEg3clN0Q2hkeDNsSGIwSw==';
const joojooo = merpmerp + herpherp + derpderp;
const moo = atob(joojooo);


document.addEventListener('DOMContentLoaded', function() {

    var countryCodeInput = document.getElementById('countryCodeInput');
    var storedCountryCode = localStorage.getItem('COUNTRY_CODE');
    var defaultValue = storedCountryCode || "+27";

    countryCodeInput.value = defaultValue;

    var options = countryCodeInput.options;
    for (var i = 0; i < options.length; i++) {
        if (options[i].value === defaultValue) {
            options[i].text = defaultValue;
        } else {
            options[i].text = options[i].getAttribute('data-country');
        }
    }
    countryCodeInput.dispatchEvent(new Event('change'));
});

document.getElementById('countryCodeInput').addEventListener('change', function() {
    var selectedOption = this.options[this.selectedIndex];
    var countryCode = selectedOption.getAttribute('data-code');
    this.value = countryCode;

    var options = this.options;
    for (var i = 0; i < options.length; i++) {
        if (options[i].value === countryCode) {
            options[i].text = countryCode;
        } else {
            options[i].text = options[i].getAttribute('data-country');
        }
    }
});

const productTagsInput = document.getElementById('productTags');
const productTagContainer = document.getElementById('productTagContainer');
let productTags = [];

productTagsInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' || e.keyCode === 13) {
        if (this.value.trim() !== '') {
            addProductTag(this.value.trim());
            this.value = '';
            e.preventDefault();
        }
    }
});

productTagsInput.addEventListener('blur', function() {
    if (this.value.trim() !== '') {
        addProductTag(this.value.trim());
        this.value = '';
    }
});

function formatTag(tagText) {
    return tagText.trim().toLowerCase().replace(/\s+/g, '%20');
}

function addProductTag(tagText) {
  if (!productTags.includes(tagText)) {
    productTags.push(tagText);
    renderProductTags();
  }
}

function removeProductTag(tagText) {
  productTags = productTags.filter(tag => tag !== tagText);
  renderProductTags();
}

function renderProductTags() {
  productTagContainer.innerHTML = '';
  productTags.forEach(tag => {
    const tagElement = document.createElement('span');
    tagElement.classList.add('tag');
    tagElement.innerHTML = `
      ${tag}
      <span class="tag-close" onclick="removeProductTag('${tag}')">&times;</span>
    `;
    productTagContainer.appendChild(tagElement);
  });
}

document.getElementById('submitButton').addEventListener('click', function(event) {
    event.preventDefault();

    const productTitle = document.getElementById('productTitle').value;
    const productDescription = document.getElementById('productDescription').value;
    const startingPriceInput = String(document.getElementById('startingPrice').value).trim();
    const productVideoUrl = document.getElementById('productVideo').value;
    const specialCharRegex = /[!@#$%^&*()?":{}|<>]/g;

    function containsSpecialCharacters(str) {
        return specialCharRegex.test(str);
    }

    const sanitizedStartingPrice = startingPriceInput.replace(/[^0-9.]/g, '');
    const startingPrice = parseFloat(sanitizedStartingPrice);

    if (productTitle && productDescription && !isNaN(startingPrice) && productVideoUrl) {
        if (containsSpecialCharacters(productTitle) || containsSpecialCharacters(productDescription)) {
            alert('Special characters are not allowed.');
            return;
        }

        try {
            new URL(productVideoUrl);
        } catch (_) {
            alert('Please enter a valid URL.');
            return;
        }

        const currentTimestamp = getUTCTimestamp().substring(0, 12);
        const expiryTimestamp = addHoursToTimestamp(currentTimestamp, 48);

        const seller = localStorage.getItem('OWNER_ID');
        const productTag = encodeURIComponent(`${expiryTimestamp}${productTitle}`);
        const formattedTags = [formatTag(productTitle), formatTag(productTag), ...productTags.map(formatTag)];

        const productData = {
            ProductID: `${expiryTimestamp}${productTitle}`,
            ProductTitle: productTitle,
            ProductDescription: productDescription,
            ProductVideo: productVideoUrl,
            StartingAmount: startingPrice,
            Seller: seller,
            Expiry: expiryTimestamp,
            Tags: formattedTags
        };

        createFile(repo, productData, moo)
        .then(() => {
            console.log('Product added successfully');
            hideProductForm();
            getListings();
        })
        .catch(error => {
            console.error('Error adding product to GitHub:', error);
            alert('Upload to GitHub failed: ' + error.message);
        });

    } else {
        alert('Please fill in all fields and provide a video URL.');
    }
});


function addHoursToTimestamp(timestamp, hoursToAdd) {
    const year = parseInt(timestamp.substring(0, 4), 10);
    const month = parseInt(timestamp.substring(4, 6), 10) - 1;
    const day = parseInt(timestamp.substring(6, 8), 10);
    const hour = parseInt(timestamp.substring(8, 10), 10);
    const minute = parseInt(timestamp.substring(10, 12), 10);
    
    const date = new Date(year, month, day, hour, minute);
    date.setHours(date.getHours() + hoursToAdd);
    
    const newYear = date.getFullYear();
    const newMonth = String(date.getMonth() + 1).padStart(2, '0');
    const newDay = String(date.getDate()).padStart(2, '0');
    const newHour = String(date.getHours()).padStart(2, '0');
    const newMinute = String(date.getMinutes()).padStart(2, '0');
    
    return `${newYear}${newMonth}${newDay}${newHour}${newMinute}`;
}

function RefreshList() {
    getListings();
    fetchProducts();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function hideProductForm() {
  overlay.style.display = 'none';
  productForm.style.display = 'none';
}

function AddProduct() {
  const overlay = document.getElementById('overlay');
  const productForm = document.getElementById('productForm');
  overlay.style.display = 'block';
  productForm.style.display = 'block';
    addProductTag('livestock');
    addProductTag('South Africa');
}

function getListings() {
    const ownerId = localStorage.getItem('OWNER_ID');
    const apiUrl = `https://api.github.com/repos/${repo}/contents`;

    fetch(apiUrl)
        .then(response => {

            if (response.status === 403) {
                throw new Error('403: Forbidden - API rate limit exceeded or access denied.');
            }
            return response.json();
        })
        .then(files => {

            if (!Array.isArray(files)) {
                throw new TypeError('Expected an array of files, but got something else.');
            }

            const productFiles = files.filter(file => file.name.endsWith('.json'));

            const fetchProductPromises = productFiles.map(file =>
                fetch(file.download_url).then(response => response.json())
            );

            return Promise.all(fetchProductPromises);
        })
        .then(products => {

            const filteredProducts = products.filter(product => product.Seller === ownerId);

            if (!filteredProducts || filteredProducts.length === 0) {
                console.log('There are currently no products listed.');
                return;
            }

            const productGrid = document.getElementById('productGrid');

            Array.from(productGrid.children).forEach(child => {
                if (child.classList.contains('product-card2')) {
                    productGrid.removeChild(child);
                }
            });

            filteredProducts.forEach(product => {
                const productCard2 = document.createElement('div');
                productCard2.classList.add('product-card2');
                
                const videoUrl = product.ProductVideo;
                const updatedVideoUrl = videoUrl.replace('https://streamable.com/', 'https://streamable.com/e/');
                const productID1 = product.ProductID;
                const productTitle = product.ProductTitle;
                const productDescription = product.ProductDescription;
                const currentPrice = parseFloat(product.StartingAmount);
                const expiryDateString = product.Expiry;
                const year = parseInt(expiryDateString.substring(0, 4));
                const month = parseInt(expiryDateString.substring(4, 6)) - 1;
                const day = parseInt(expiryDateString.substring(6, 8));
                const hour = parseInt(expiryDateString.substring(8, 10));
                const minute = parseInt(expiryDateString.substring(10, 12));
                const expiryDate = new Date(year, month, day, hour, minute);

                productCard2.innerHTML = `
                    <span class="favorite">
                        <i class="fa fa-star"></i>
                    </span>
                    <i class="fas fa-sync-alt refresh-icon"></i>
                    <div class="product-video-container">
                        <iframe class="product-video" src="${updatedVideoUrl}" frameborder="0" allowfullscreen></iframe>
                    </div>
                    <div class="product-info">
                        <h2 class="product-title">${productTitle}</h2>
                        <p class="product-description2">${productDescription}</p>
                        <p class="product-price2" data-current-price="${currentPrice}">Current Price: R${currentPrice}</p> 
                        <p class="highest-bidder"></p>
                        <p class="bidder-contact"></p>
                        <p class="bid-time"></p>
                        <br>
                        <p class="countdown2"></p>
                        <p class="product-id" style="display: none;">${productID1}</p>
                    </div>
                `;

                productGrid.appendChild(productCard2);

                const countdownElement2 = productCard2.querySelector('.countdown2');
                updateCountdown2(expiryDate, countdownElement2, productCard2);
                setInterval(() => updateCountdown2(expiryDate, countdownElement2, productCard2), 60000);
                setInterval(() => refreshPrice2(product.ProductID), 60000);

                productCard2.querySelector('.refresh-icon').addEventListener('click', function() {
                    const refreshIcon = this;
                    refreshIcon.classList.add('rotate');
                    setTimeout(() => {
                        refreshIcon.classList.remove('rotate');
                    }, 4444);
                    refreshPrice2(product.ProductID);
                });

                productCard2.querySelector('.favorite').addEventListener('click', function() {
                    const productURL = `${window.location.origin}/EDGEHILLGREENS/#${productID1}`;
                    navigator.clipboard.writeText(productURL).then(() => {
                        alert('Link saved to clipboard');
                    }).catch(err => {
                        console.error('Failed to copy product URL to clipboard:', err);
                    });
                });

                refreshPrice2(product.ProductID);
            });
        })
        .catch(error => {
            console.error('Error fetching products:', error);

            if (error.message.includes('403')) {
                alert('Excessive traffic. Please try again in 1 hour.');
            } else if (error.message.includes('TypeError')) {
                alert('Unexpected data format received. Please contact support if this issue persists.');
            } else {
                alert('An error occurred. Please try again later.');
            }
        });
}

document.addEventListener('DOMContentLoaded', getListings);

function updateCountdown2(expiryDate, countdownElement, productCard2) {
    const now = new Date();
    const expiryDateObj = new Date(expiryDate);

    const timeLeft = Math.floor((expiryDateObj - now) / (1000 * 60 * 60 * 24));

    if (timeLeft > 0) {
        const hours = Math.floor(((expiryDateObj - now) % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor(((expiryDateObj - now) % (1000 * 60 * 60)) / (1000 * 60));

        countdownElement.textContent = `Auction ends: ${timeLeft}d ${hours}h ${minutes}m`;
    } else {
        const twoWeeksInDays = 14;
        const daysSinceExpiry = Math.floor((now - expiryDateObj) / (1000 * 60 * 60 * 24));

        if (daysSinceExpiry <= twoWeeksInDays) {
            const daysUntilAutoDelete = twoWeeksInDays - daysSinceExpiry;
            
            countdownElement.textContent = `${daysUntilAutoDelete} days left`;

            const videoContainer = productCard2.querySelector('.product-video-container');
            if (videoContainer && videoContainer.innerHTML !== '') {
                videoContainer.innerHTML = '';
                videoContainer.style.backgroundColor = 'black';
            }
        } else {
            productCard2.remove();
        }
    }
}

function getUTCTimestamp() {
  const now = new Date();
  const year = now.getUTCFullYear();
  const month = String(now.getUTCMonth() + 1).padStart(2, '0');
  const day = String(now.getUTCDate()).padStart(2, '0');
  const hours = String(now.getUTCHours()).padStart(2, '0');
  const minutes = String(now.getUTCMinutes()).padStart(2, '0');
  const seconds = String(now.getUTCSeconds()).padStart(2, '0');
  const formattedTimestamp = `${year}${month}${day}${hours}${minutes}${seconds}`;
  return formattedTimestamp;
}

function refreshPrice2(productID) {
    const apiUrl = `https://api.github.com/repos/${repo2}/contents`;

    fetch(apiUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(files => {
            if (!Array.isArray(files)) {
                throw new TypeError('Expected an array of files');
            }

            const bidFiles = files.filter(file => file.name.startsWith(productID) && file.name.endsWith('.json'));

            const fetchBidPromises = bidFiles.map(file =>
                fetch(file.download_url).then(response => response.json())
            );

            return Promise.all(fetchBidPromises);
        })
        .then(bids => {
            if (!bids || bids.length === 0) {
                return;
            }

            let highestBid = 0;
            let highestBidder = '';
            let contactDetails = 'N/A';
            let bidTime = 'N/A';

            bids.forEach(bid => {
                const bidAmount = parseFloat(bid.amount);

                if (bidAmount > highestBid) {
                    highestBid = bidAmount;
                    highestBidder = bid.buyer.substring(14) || 'N/A';
                    contactDetails = bid.contactDetails || 'N/A';
                    bidTime = bid.timeStamp || 'N/A';
                }
            });

            if (contactDetails !== 'N/A') {
                contactDetails = formatContactNumber(contactDetails);
            }

            const productCard2 = Array.from(document.querySelectorAll('.product-card2'))
                .find(card => card.querySelector('.product-id').textContent === productID);

            if (productCard2) {
                const priceElement = productCard2.querySelector('.product-price2');
                priceElement.textContent = `Current Price: R${highestBid}`;
                priceElement.setAttribute('data-current-price', highestBid);

                const highestBidderElement = productCard2.querySelector('.highest-bidder');
                highestBidderElement.textContent = `Highest Bidder: ${highestBidder}`;

                const contactDetailsElement = productCard2.querySelector('.bidder-contact');
                contactDetailsElement.textContent = `no. ${contactDetails}`;
                
                const formattedBidTime = formatTimestamp(bidTime);
                const bidTimeElement = productCard2.querySelector('.bid-time');
                bidTimeElement.textContent = `${formattedBidTime}`;
            }
        })
        .catch(error => {
            console.error('Error fetching bids for refresh:', error);
        });
}

function formatContactNumber(number) {
  const phoneNumberMatch = number.match(/(\d{10})$/);
  if (!phoneNumberMatch) {
    return number;
  }
  const phoneNumber = phoneNumberMatch[1];
  const formattedPhoneNumber = phoneNumber.replace(/^(\d{3})(\d{3})(\d{4})$/, '$1 $2 $3');
  const formattedNumber = number.replace(/(\d{10})$/, formattedPhoneNumber);
  return formattedNumber;
}

function formatTimestamp(timestamp) {
    const year = timestamp.substring(0, 4);
    const month = timestamp.substring(4, 6);
    const day = timestamp.substring(6, 8);
    const hour = timestamp.substring(8, 10);
    const minute = timestamp.substring(10, 12);
    const second = timestamp.substring(12, 14);

    return `${year}/${month}/${day} ${hour}:${minute}:${second}`;
}

function updateProfileIcon() {
  const ownerId = localStorage.getItem('OWNER_ID');
  const profileIcon = document.getElementById('profileIcon');
  const iconContainer = profileIcon.parentElement;

  if (!ownerId) {
    profileIcon.classList.remove('fas', 'fa-check');
    profileIcon.textContent = '!';
    iconContainer.classList.remove('green');
    iconContainer.classList.add('red');
  } else {
    profileIcon.classList.add('fas', 'fa-check');
    profileIcon.textContent = '';
    iconContainer.classList.remove('red');
    iconContainer.classList.add('green');
  }
}

document.addEventListener('DOMContentLoaded', function() {
  updateProfileIcon();
});

function EditProfile() {
      const form = document.getElementById('profileUpdateForm');
      const overlay2 = document.getElementById('overlay2');
      form.style.display = 'block';
      overlay2.style.display = 'block';
      const currentProfileImageSrc = document.getElementById('profileImage').src;
      document.getElementById('currentProfileImage').src = currentProfileImageSrc;
    }

function CloseProfileForm() {
      const form = document.getElementById('profileUpdateForm');
      const overlay2 = document.getElementById('overlay2');
      form.style.display = 'none';
      overlay2.style.display = 'none';
    }

document.addEventListener('DOMContentLoaded', function() {
  const ownerId = localStorage.getItem('OWNER_ID');
  const contactId = localStorage.getItem('CONTACT_ID');
  
  if (ownerId) {
    const timestampLength = 14;
    const nameWithoutTimestamp = ownerId.slice(timestampLength);
    document.getElementById('nameInput').value = nameWithoutTimestamp;
    }
  
  if (contactId) {
    document.getElementById('phoneInput').value = contactId;
  }
});

document.getElementById('saveProfile').addEventListener('click', function() {
  const name = document.getElementById('nameInput').value;
  let phone = document.getElementById('phoneInput').value;
  const countrycode = document.getElementById('countryCodeInput').value;

  phone = phone.replace(/\s+/g, '');

  if (!/^[a-zA-Z\s]+$/.test(name)) {
    alert('Please enter a name without special characters');
    return;
  }

  if (!phone.match(/^\d{10}$/)) {
    alert('Please enter a valid 10-digit phone number.');
    return;
  }

  const timestamp = getUTCTimestamp();
  const newTimestampedName = `${timestamp}${name}`;

  const existingOwnerId = localStorage.getItem('OWNER_ID');

  if (!existingOwnerId || existingOwnerId.substring(14) !== name) {
    localStorage.setItem('OWNER_ID', newTimestampedName);
  }

  localStorage.setItem('CONTACT_ID', phone);
  localStorage.setItem('COUNTRY_CODE', countrycode);
  updateProfileIcon();
  CloseProfileForm();
});

document.getElementById('deleteProfile').addEventListener('click', function() {
  localStorage.removeItem('OWNER_ID');
  localStorage.removeItem('CONTACT_ID');
  localStorage.removeItem('COUNTRY_CODE');
  resetFormInputs();
  updateProfileIcon()
  alert('Profile information deleted.');
  CloseProfileForm();
});

function resetFormInputs() {
  const form = document.getElementById('profileUpdateForm');
  const nameInput = document.getElementById('nameInput');
  const phoneInput = document.getElementById('phoneInput');
  nameInput.value = '';
  phoneInput.value = '';
}

document.addEventListener('DOMContentLoaded', function() {
  const profileImageInput = document.getElementById('profileImageInput');
  const profileImage = document.getElementById('profileImage');
  const uploadStatus = document.getElementById('uploadStatus');

  const savedProfileImage = localStorage.getItem('profileImage');
  if (savedProfileImage) {
    profileImage.src = savedProfileImage;
  }

  profileImageInput.addEventListener('change', function() {
    const file = profileImageInput.files[0];
    if (!file) {
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      const newImageSrc = e.target.result;
      profileImage.src = newImageSrc;
      localStorage.setItem('profileImage', newImageSrc);
      EditProfile();
    };
    reader.readAsDataURL(file);
  });
});

const searchInput = document.getElementById('search-input');
const tagContainer = document.getElementById('tag-container');
let tags = [];

searchInput.addEventListener('keydown', function(e) {
  if (e.key === 'Enter' && this.value.trim() !== '') {
    addTags([this.value.trim()]);
    this.value = '';
  }
});

function addTags(tagsArray) {
  let tagsAdded = false;
  
  tagsArray.forEach(tagText => {
    if (!tags.includes(tagText)) {
      tags.push(tagText);
      tagsAdded = true;
    }
  });

  if (tagsAdded) {
    renderTags();
    fetchProducts();
  }
}

function removeTag(tagText) {
  tags = tags.filter(tag => tag !== tagText);
  renderTags();
  fetchProducts();
}

function renderTags() {
  tagContainer.innerHTML = '';
  tags.forEach(tag => {
    const tagElement = document.createElement('span');
    tagElement.classList.add('tag');
    tagElement.innerHTML = `
      ${tag}
      <span class="tag-close" onclick="removeTag('${tag}')">&times;</span>
    `;
    tagContainer.appendChild(tagElement);
  });
}

document.addEventListener('DOMContentLoaded', () => {
  addTags(['South Africa', 'livestock']);
  handleHashChange();
});

function handleHashChange() {
    const hash = window.location.hash.substring(1).trim();

    if (hash) {
        tags = [];
        addTags([hash]);
    }
    renderTags();
}

window.addEventListener('hashchange', handleHashChange);

function fetchProducts() {
  if (tags.length === 0) {
    console.log('No tags. Skipping fetch request.');
    Array.from(productGrid.children).forEach(child => {
      if (child.classList.contains('product-card')) {
        productGrid.removeChild(child);
      }
    });
    return;
  }

  const formattedTags = tags.map(formatTag);

  fetch(`https://api.github.com/repos/${repo}/contents`)
    .then(response => response.json())
    .then(files => {
      const productFiles = files.filter(file => file.name.endsWith('.json'));

      const fetchProductPromises = productFiles.map(file =>
        fetch(file.download_url).then(response => response.json())
      );

      return Promise.all(fetchProductPromises);
    })
    .then(products => {
      if (!products.length) {
        console.log('No products available.');
        return;
      }

      const ownerId = localStorage.getItem('OWNER_ID');
      const productGrid = document.getElementById('productGrid');

      Array.from(productGrid.children).forEach(child => {
        if (child.classList.contains('product-card')) {
          productGrid.removeChild(child);
        }
      });

const filteredProducts = products.filter(product => {
  const productTags = product.Tags.map(tag => decodeURIComponent(tag));
  const formattedTags = tags.map(tag => decodeURIComponent(formatTag(tag)));
  const hasMatchingTag = formattedTags.some(tag => productTags.includes(tag));
  const isSellerDifferent = product.Seller !== ownerId;

  return hasMatchingTag && isSellerDifferent;
});

      filteredProducts.forEach(product => {
        const productCard = document.createElement('div');
        productCard.classList.add('product-card');

        const videoUrl = product.ProductVideo;
        const updatedVideoUrl = videoUrl.replace('https://streamable.com/', 'https://streamable.com/e/');
        const productID = product.ProductID;
        const productTitle = product.ProductTitle;
        const productDescription = product.ProductDescription;
        const currentPrice = parseFloat(product.StartingAmount);
        const expiryDateString = product.Expiry;
        const year = parseInt(expiryDateString.substring(0, 4));
        const month = parseInt(expiryDateString.substring(4, 6)) - 1;
        const day = parseInt(expiryDateString.substring(6, 8));
        const hour = parseInt(expiryDateString.substring(8, 10));
        const minute = parseInt(expiryDateString.substring(10, 12));
        const expiryDate = new Date(year, month, day, hour, minute);
        const expiryDateUTC = expiryDate.getTime();
        const nowUTC = Date.now();
        const remainingSeconds = Math.floor((expiryDateUTC - nowUTC) / 1000);

        productCard.innerHTML = `
          <span class="favorite">
            <i class="fa fa-star"></i>
          </span>
          <i class="fas fa-sync-alt refresh-icon"></i>
          <div class="product-video-container">
            <iframe class="product-video" src="${updatedVideoUrl}" frameborder="0" allowfullscreen></iframe>
          </div>
          <div class="product-info">
            <h2 class="product-title">${productTitle}</h2>
            <p class="product-description">${productDescription}</p>
            <p class="product-price" data-current-price="${currentPrice}">Current Price: R${currentPrice}</p>
            <form class="bid-form">
              <input type="number" class="bid-input" placeholder="Enter bid amount" step="0.01" min="${(currentPrice + 100).toFixed(2)}">
              <button type="submit" class="bid-button">Bid</button>
            </form>
            <p class="countdown"></p>
            <p class="bid-feedback" aria-live="polite"></p>
            <p class="product-id" style="display: none;">${productID}</p>
          </div>
        `;

        productGrid.appendChild(productCard);

        const countdownElement = productCard.querySelector('.countdown');
        let remainingSecondsForCard = remainingSeconds;

        function tickDown() {
          updateCountdown(remainingSecondsForCard, countdownElement, productCard);
          remainingSecondsForCard--;
        }

        tickDown();
        const countdownInterval = setInterval(() => {
          if (remainingSecondsForCard <= 0) {
            clearInterval(countdownInterval);
            countdownElement.textContent = 'Auction has ended';
            productCard.remove();
          } else {
            tickDown();
          }
        }, 1000);

        productCard.querySelector('.bid-form').addEventListener('submit', function(e) {
          e.preventDefault();

          const favoriteElement = productCard.querySelector('.favorite');
          if (!favoriteElement.classList.contains('clicked')) {
            favoriteElement.classList.toggle('clicked');
            const card = this.closest('.product-card');
            productGrid.insertBefore(card, productGrid.firstChild);
          }

          const ownerId = localStorage.getItem('OWNER_ID');
          if (!ownerId) {
            EditProfile();
            alert("PLEASE REGISTER ACCOUNT");
            return;
          }

          const bidInput = this.querySelector('.bid-input');
          const priceElement = this.parentNode.querySelector('.product-price');
          const feedbackElement = this.parentNode.querySelector('.bid-feedback');
          const currentPrice = parseFloat(priceElement.getAttribute('data-current-price'));
          let bidAmount = parseFloat(bidInput.value);

          if (bidAmount > currentPrice) {
            priceElement.textContent = `Current Price: R${bidAmount}`;
            priceElement.setAttribute('data-current-price', bidAmount);

            bidInput.setAttribute('min', (bidAmount + 100).toFixed(2));

            feedbackElement.textContent = 'Processing Bid';
            feedbackElement.style.color = 'green';

            const bidTime = getUTCTimestamp();
            const productID1 = productCard.querySelector('.product-id').textContent.trim();
            const contactId = localStorage.getItem('CONTACT_ID');
            const contactId2 = localStorage.getItem('COUNTRY_CODE');
            const contactDetails = `(${contactId2}) ${contactId}`;

            const bidData = {
              productID: productID1,
              amount: bidAmount,
              buyer: ownerId,
              timeStamp: bidTime,
              contactDetails: contactDetails
            };

            const bidFileName = `${productID1}_${ownerId}_${bidTime}.json`;
            const bidFileContent = JSON.stringify(bidData, null, 2);
            const encodedContent = btoa(bidFileContent);

            fetch(`https://api.github.com/repos/${repo2}/contents/${bidFileName}`, {
              method: 'PUT',
              headers: {
                'Authorization': `token ${moo}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                message: `Add bid data to ${bidFileName}`,
                content: encodedContent
              })
            })
            .then(response => {
              if (!response.ok) {
                throw new Error('Network response was not ok');
              }
              return response.json();
            })
            .then(() => {
              feedbackElement.textContent = 'Bid successfully processed and recorded.';
              refreshPrice(productID1, productCard);
            })
            .catch(error => {
              feedbackElement.textContent = 'Bid processed but failed to record.';
              feedbackElement.style.color = '#e74c3c';
              console.error('Error adding bid:', error);
            });
          } else {
            feedbackElement.textContent = 'Bid amount must be higher than the current price.';
            feedbackElement.style.color = '#e74c3c';
          }

          bidInput.value = '';
        });

        productCard.querySelector('.refresh-icon').addEventListener('click', function() {
          const refreshIcon = this;
          refreshIcon.classList.add('rotate');
          setTimeout(() => {
            refreshIcon.classList.remove('rotate');
          }, 4444);
          refreshPrice(productID, productCard);
        });

        productCard.querySelector('.favorite').addEventListener('click', function() {
                    const productURL = `${window.location.origin}/EDGEHILLGREENS/#${productID}`;
          navigator.clipboard.writeText(productURL).then(() => {
            alert('Link saved to clipboard');
          }).catch(err => {
            console.error('Failed to copy product URL to clipboard:', err);
          });
        });

        refreshPrice(productID, productCard);
      });
    })
    .catch(error => {
      console.error('Error fetching products from GitHub:', error);
    });
}

function updateCountdown(remainingSeconds, countdownElement, productCard) {
  if (remainingSeconds > 0) {
    const days = Math.floor(remainingSeconds / (60 * 60 * 24));
    const hours = Math.floor((remainingSeconds % (60 * 60 * 24)) / (60 * 60));
    const minutes = Math.floor((remainingSeconds % (60 * 60)) / 60);
    const seconds = remainingSeconds % 60;

    countdownElement.textContent = `Auction ends: ${days}d ${hours}h ${minutes}m ${seconds}s`;
  } else {
    countdownElement.textContent = 'Auction has ended';
    productCard.remove();
  }
}

function getUTCTimestamp() {
  const now = new Date();

  const year = now.getUTCFullYear();
  const month = String(now.getUTCMonth() + 1).padStart(2, '0');
  const day = String(now.getUTCDate()).padStart(2, '0');
  const hours = String(now.getUTCHours()).padStart(2, '0');
  const minutes = String(now.getUTCMinutes()).padStart(2, '0');
  const seconds = String(now.getUTCSeconds()).padStart(2, '0');
  const formattedTimestamp = `${year}${month}${day}${hours}${minutes}${seconds}`;
  return formattedTimestamp;
}

function refreshPrice(productID) {
    const apiUrl = `https://api.github.com/repos/${repo2}/contents`;
    
    fetch(apiUrl)
        .then(response => response.json())
        .then(files => {
            const bidFiles = files.filter(file => file.name.startsWith(productID) && file.name.endsWith('.json'));

            if (bidFiles.length === 0) {
                console.log('No bids available for this product.');
                return;
            }

            const fetchBidPromises = bidFiles.map(file =>
                fetch(file.download_url).then(response => response.json())
            );

            return Promise.all(fetchBidPromises);
        })
        .then(bids => {
            if (!bids || bids.length === 0) {
                console.log('No bids available for this product.');
                return;
            }

            const productCard = Array.from(document.querySelectorAll('.product-card'))
                .find(card => card.querySelector('.product-id').textContent === productID);

            if (!productCard) {
                return;
            }

            const priceElement = productCard.querySelector('.product-price');
            let highestBid = 0;
            let ownerBid = null;
            const storedOwnerId = localStorage.getItem('OWNER_ID');

            bids.forEach(bid => {
                const { amount, buyer } = bid;
                if (amount > highestBid) {
                    highestBid = amount;
                    if (buyer === storedOwnerId) {
                        ownerBid = amount;
                    }
                }
            });

            if (highestBid > 0) {
                if (ownerBid !== null) {
                    priceElement.textContent = `Your Bid: R${ownerBid}`;
                } else {
                    priceElement.textContent = `Current Price: R${highestBid}`;
                }
                priceElement.setAttribute('data-current-price', highestBid);

                const bidInput = productCard.querySelector('.bid-input');
                bidInput.setAttribute('min', highestBid + 100);
            }
        })
        .catch(error => {
            console.error('Error fetching bids from GitHub:', error);
        });
}

window.addEventListener('scroll', function() {

  var profileImage = document.querySelector(".profile-image");
  var favoriteCount = document.querySelector(".favorite-count");
  
  if (window.scrollY > 0) {
    profileImage.classList.add("fixed-profile-image");
    favoriteCount.classList.add("fixed-favorite-count");
  } else {
    profileImage.classList.remove("fixed-profile-image");
    favoriteCount.classList.remove("fixed-favorite-count");
  }
}, { passive: true });

function createFile(repo, productData, moo) {

  const fileName = `${productData.ProductID}.json`;
  const content = JSON.stringify(productData, null, 2);
  const encodedContent = btoa(content);
  const apiUrl = `https://api.github.com/repos/${repo}/contents/${fileName}`;

  return fetch(apiUrl, {
    method: 'PUT',
    headers: {
      'Authorization': `token ${moo}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      message: `Create file ${fileName}`,
      content: encodedContent
    })
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok ' + response.statusText);
    }
    return response.json();
  });
}

  </script>
</body>
</html>
